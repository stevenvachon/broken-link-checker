{"version":3,"file":"streamHTML.js","names":["_errors","require","_httpMethodsConstants","_errors2","_request","_interopRequireDefault","obj","__esModule","default","CONTENT_TYPE","HTML_MIMETYPE","XHTML_MIMETYPE","_default","url","auth","cache","options","result","request","GET","response","headers","status","HTMLRetrievalError","type","startsWith","ExpectedHTMLMediaTypeError","exports","module"],"sources":["../../../lib/internal/http-protocol/streamHTML.js"],"sourcesContent":["import {ExpectedHTMLMediaTypeError} from \"./errors\";\nimport {GET} from \"http-methods-constants\";\nimport {HTMLRetrievalError} from \"../errors\";\nimport request from \"./request\";\n\n\n\nconst CONTENT_TYPE = \"content-type\";\nconst HTML_MIMETYPE = \"text/html\";\nconst XHTML_MIMETYPE = \"application/xhtml+xml\";\n\n\n\n/**\n * Request a URL for its HTML contents.\n * @param {URL} url\n * @param {object} auth\n * @param {URLCache} cache\n * @param {object} options\n * @throws {ExpectedHTMLMediaTypeError} if not HTML media type\n * @throws {HTMLRetrievalError} 404, etc\n * @throws {Error} if failed connection\n * @returns {Promise<object>}\n */\nexport default async (url, auth, cache, options) =>\n{\n\tconst result = await request(url, auth, GET, cache, options);\n\tconst {response: {headers, status}} = result;\n\n\tif (status<200 || status>299)\n\t{\n\t\tthrow new HTMLRetrievalError(status);\n\t}\n\telse\n\t{\n\t\tconst type = headers[CONTENT_TYPE];\n\n\t\t// Content-type is not mandatory in HTTP spec\n\t\t// Could have trailing charset\n\t\tif (!type?.startsWith(HTML_MIMETYPE) && !type?.startsWith(XHTML_MIMETYPE))\n\t\t{\n\t\t\tthrow new ExpectedHTMLMediaTypeError(type, status);\n\t\t}\n\t}\n\n\treturn result;\n};\n"],"mappings":";;;;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,qBAAA,GAAAD,OAAA;AACA,IAAAE,QAAA,GAAAF,OAAA;AACA,IAAAG,QAAA,GAAAC,sBAAA,CAAAJ,OAAA;AAAgC,SAAAI,uBAAAC,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAIhC,MAAMG,YAAY,GAAG,cAAc;AACnC,MAAMC,aAAa,GAAG,WAAW;AACjC,MAAMC,cAAc,GAAG,uBAAuB;;AAI9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA,IAAAC,QAAA,GAWe,MAAAA,CAAOC,GAAG,EAAEC,IAAI,EAAEC,KAAK,EAAEC,OAAO,KAC/C;EACC,MAAMC,MAAM,GAAG,MAAM,IAAAC,gBAAO,EAACL,GAAG,EAAEC,IAAI,EAAEK,yBAAG,EAAEJ,KAAK,EAAEC,OAAO,CAAC;EAC5D,MAAM;IAACI,QAAQ,EAAE;MAACC,OAAO;MAAEC;IAAM;EAAC,CAAC,GAAGL,MAAM;EAE5C,IAAIK,MAAM,GAAC,GAAG,IAAIA,MAAM,GAAC,GAAG,EAC5B;IACC,MAAM,IAAIC,2BAAkB,CAACD,MAAM,CAAC;EACrC,CAAC,MAED;IACC,MAAME,IAAI,GAAGH,OAAO,CAACZ,YAAY,CAAC;;IAElC;IACA;IACA,IAAI,EAACe,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEC,UAAU,CAACf,aAAa,CAAC,KAAI,EAACc,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEC,UAAU,CAACd,cAAc,CAAC,GACzE;MACC,MAAM,IAAIe,kCAA0B,CAACF,IAAI,EAAEF,MAAM,CAAC;IACnD;EACD;EAEA,OAAOL,MAAM;AACd,CAAC;AAAAU,OAAA,CAAAnB,OAAA,GAAAI,QAAA;AAAAgB,MAAA,CAAAD,OAAA,GAAAA,OAAA,CAAAnB,OAAA"}