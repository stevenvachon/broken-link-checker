{"version":3,"file":"UrlChecker.js","names":["_checkLink","_interopRequireDefault","require","_events","_isurl","_Link","_interopRequireWildcard","_parseOptions","_limitedRequestQueue","_SafeEventEmitter","_urlcache","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","obj","UrlChecker","SafeEventEmitter","cache","linkQueue","constructor","options","parseOptions","URLCache","maxAge","cacheMaxAge","RequestQueue","maxSockets","maxSocketsPerHost","rateLimit","on","ITEM_EVENT","url","auth","customData","link","done","result","checkLink","WAS_EXCLUDED","emit","JUNK_EVENT","LINK_EVENT","REQUEST_QUEUE_END_EVENT","END_EVENT","clearCache","clear","dequeue","id","success","QUEUE_EVENT","enqueue","Link","isURL","resolve","TypeError","REBASED_URL","isPaused","numActiveLinks","numActive","numQueuedLinks","numQueued","pause","resume","__cache","exports","module"],"sources":["../../lib/public/UrlChecker.js"],"sourcesContent":["import checkLink from \"../internal/checkLink\";\nimport {END_EVENT, JUNK_EVENT, LINK_EVENT, QUEUE_EVENT} from \"../internal/events\";\nimport isURL from \"isurl\";\nimport Link, {REBASED_URL, WAS_EXCLUDED} from \"../internal/Link\";\nimport parseOptions from \"../internal/parseOptions\";\nimport RequestQueue, {ITEM_EVENT, END_EVENT as REQUEST_QUEUE_END_EVENT} from \"limited-request-queue\";\nimport SafeEventEmitter from \"../internal/SafeEventEmitter\";\nimport URLCache from \"urlcache\";\n\n\n\nexport default class UrlChecker extends SafeEventEmitter\n{\n\t#cache;\n\t#linkQueue;\n\n\n\n\tconstructor(options)\n\t{\n\t\tsuper();\n\n\t\toptions = parseOptions(options);\n\n\t\tthis.#cache = new URLCache({ maxAge:options.cacheMaxAge });\n\n\t\tthis.#linkQueue = new RequestQueue(\n\t\t{\n\t\t\tmaxSockets:        options.maxSockets,\n\t\t\tmaxSocketsPerHost: options.maxSocketsPerHost,\n\t\t\trateLimit:         options.rateLimit\n\t\t})\n\t\t.on(ITEM_EVENT, async (url, {auth, customData, link}, done) =>\n\t\t{\n\t\t\tconst result = await checkLink(link, auth, this.#cache, options);\n\n\t\t\tif (result.get(WAS_EXCLUDED))\n\t\t\t{\n\t\t\t\tthis.emit(JUNK_EVENT, result, customData);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.emit(LINK_EVENT, result, customData);\n\t\t\t}\n\n\t\t\t// Auto-starts next queue item, if any\n\t\t\t// Emits REQUEST_QUEUE_END_EVENT, if not\n\t\t\tdone();\n\t\t})\n\t\t.on(REQUEST_QUEUE_END_EVENT, () => this.emit(END_EVENT));\n\t}\n\n\n\n\tclearCache()\n\t{\n\t\tthis.#cache.clear();\n\t\treturn this;\n\t}\n\n\n\n\tdequeue(id)\n\t{\n\t\tconst success = this.#linkQueue.dequeue(id);\n\n\t\tthis.emit(QUEUE_EVENT);\n\n\t\treturn success;\n\t}\n\n\n\n\t// `auth` is undocumented and for internal use only\n\tenqueue(url, customData, auth={})\n\t{\n\t\tlet link;\n\n\t\t// Undocumented internal use: `enqueue(Link)`\n\t\tif (url instanceof Link)\n\t\t{\n\t\t\tlink = url;\n\t\t}\n\t\t// Documented use: `enqueue(URL)`\n\t\telse if (isURL(url))\n\t\t{\n\t\t\tlink = new Link().resolve(url);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new TypeError(\"Invalid URL\");\n\t\t}\n\n\t\tconst id = this.#linkQueue.enqueue(link.get(REBASED_URL), { auth, customData, link });\n\n\t\tthis.emit(QUEUE_EVENT);\n\n\t\treturn id;\n\t}\n\n\n\n\thas(id)\n\t{\n\t\treturn this.#linkQueue.has(id);\n\t}\n\n\n\n\tget isPaused()\n\t{\n\t\treturn this.#linkQueue.isPaused;\n\t}\n\n\n\n\tget numActiveLinks()\n\t{\n\t\treturn this.#linkQueue.numActive;\n\t}\n\n\n\n\tget numQueuedLinks()\n\t{\n\t\treturn this.#linkQueue.numQueued;\n\t}\n\n\n\n\tpause()\n\t{\n\t\tthis.#linkQueue.pause();\n\t\treturn this;\n\t}\n\n\n\n\tresume()\n\t{\n\t\tthis.#linkQueue.resume();\n\t\treturn this;\n\t}\n\n\n\n\tget __cache()\n\t{\n\t\treturn this.#cache;\n\t}\n}\n"],"mappings":"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"}